<!DOCTYPE html>

<html lang="ja">

<HEAD>
<title>StkWebApp</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="./style.css" type="text/css">
</HEAD>

<BODY>
<div id="container">
<H1>3. stkcommon</H1>



<H2 ID="3.1">3.1 stkcommon概要</H2>
<div class="topic">
  stkcommonは，レスポンシブなWebアプリケーションを実現するための，共通のライブラリです。<br/>
  stkcommonを使用することにより，レスポンシブなWebアプリケーションを，効率よく開発することができます。<br/>
  stkcommonは以下のファイルを含んでいます。<br/>
  <ul>
  <li>stkcommon.js</li>
  <li>stkcommon.css</li>
  <li>IcoMoon-Free.ttf</li>
  <li>IcoMoon-Free.css</li>
  </ul>
</div><p>



<H2 ID="3.2">3.2 stkcommonの前提ソフトウェア</H2>
<div class="topic">
  stkcommonは以下のソフトウェアを前提とします。<br/>
  stkcommonを使用するソフトウェアは，事前にこれらのソフトウェアを組み込んでおく必要があります。<br/>
  <ul>
  <li>Bootstrap 4.4.1</li>
  <li>JQuery 3.2.0</li>
  </ul>
</div>



<H2 ID="3.3">3.3 stkcommonのAPI一覧</H2>
<div class="topic">
stkcommonの公開APIには下記のものがあります。<br/>
<table class="tblstyle">
<tr><td><a href="#3.4.1">function showLoginModal(func)</a></td><td>ログインダイアログを表示します。</td></tr>
<tr><td><a href="#3.4.2">function showInputModal(title, contents)</a></td><td>入力ダイアログを表示します。</td></tr>
<tr><td><a href="#3.4.3">function closeInputModal()</a></td><td>入力ダイアログを閉じます。</td></tr>
<tr><td><a href="#3.4.4">function initMainPage(title, iconname, contents)</a></td><td>メインページを初期化します。</td></tr>
<tr><td><a href="#3.4.5">function addRsCommand(func, icon, enable)</a></td><td>ナビゲーションバーにコマンドアイコンを追加します。</td></tr>
<tr><td><a href="#3.4.6">function clearRsCommand()</a></td><td>ナビゲーションバーのコマンドアイコンおよびドロップダウンメニューをクリアします。</td></tr>
<tr><td><a href="#3.4.7">function addRsUserMenu(contents)</a></td><td>ユーザーメニューに要素を追加します。</td></tr>
<tr><td><a href="#3.4.8">function clearRsUserMenu()</a></td><td>ユーザーメニューをクリアします。</td></tr>
<tr><td><a href="#3.4.9">function addDropDown(dropdownTitle)</a></td><td>ナビゲーションバーにドロップダウンメニューを追加します。</td></tr>
<tr><td><a href="#3.4.10">function changeDropDownTitle(dropdownTitle)</a></td><td>ナビゲーションバーのドロップダウンメニューのタイトルを変更します。</td></tr>
<tr><td><a href="#3.4.11">function getDropDownMenu(index)</a></td><td>ナビゲーションバーのドロップダウンメニューの要素名を取得します。</td></tr>
<tr><td><a href="#3.4.12">function addDropDownMenu(index, menuTitle, func)</a></td><td>ナビゲーションバーのドロップダウンメニューに要素を追加します。</td></tr>
<tr><td><a href="#3.4.13">function addClientMessage(code, msg)</a></td><td>クライアントメッセージを追加します。</td></tr>
<tr><td><a href="#3.4.14">function deleteClientMessage(code)</a></td><td>クライアントメッセージを削除します。</td></tr>
<tr><td><a href="#3.4.15">function getClientMessageEn(code)</a></td><td>クライアントメッセージ(英語)を取得します。</td></tr>
<tr><td><a href="#3.4.16">function getClientMessageJa(code)</a></td><td>クライアントメッセージ(日本語)を取得します。</td></tr>
<tr><td><a href="#3.4.17">function setClientLanguage(lang)</a></td><td>クライアントメッセージの言語を指定します。</td></tr>
<tr><td><a href="#3.4.18">function getClientLanguage()</a></td><td>クライアントメッセージの言語を取得します。</td></tr>
<tr><td><a href="#3.4.19">function getClientMessage(code)</a></td><td>クライアントメッセージを指定した言語で取得します。</td></tr>
<tr><td><a href="#3.4.20">function displayAlertSuccess(parent, msg)</a></td><td>Successメッセージを表示します。</td></tr>
<tr><td><a href="#3.4.21">function displayAlertDanger(parent, msg)</a></td><td>Dangerメッセージを表示します。</td></tr>
<tr><td><a href="#3.4.22">function displayAlertWarning(parent, msg)</a></td><td>Warningメッセージを表示します。</td></tr>
<tr><td><a href="#3.4.23">function displayAlertInfo(parent, msg)</a></td><td>Infoメッセージを表示します。</td></tr>
<tr><td><a href="#3.4.24">function apiCall(method, url, request, keystring, targetFunc)</a></td><td>REST APIを非同期で呼び出します。</td></tr>
<tr><td><a href="#3.4.25">function MultiApiCall(contents, targetFunc)</a></td><td>複数のREST APIを非同期で同時に呼び出します。</td></tr>
<tr><td><a href="#3.4.26">function setLoginResult(result)</a></td><td>ユーザープログラムで行った認証結果をstkcommon.jsに通知する。</td></tr>
<tr><td><a href="#3.4.27">function changeLoginPassword(password)</a></td><td>ログインユーザーのパスワードを変更します。</td></tr>
<tr><td><a href="#3.4.28">function setAuthenticationToken(token)</a></td><td>認証用トークンを設定します。</td></tr>
<tr><td><a href="#3.4.29">function getUserName()</a></td><td>ユーザー名を取得します。</td></tr>
<tr><td><a href="#3.4.30">function isPasswordCorrect(password)</a></td><td>指定されたパスワードが正しいか判定します。</td></tr>
<tr><td><a href="#3.4.31">function drowContainer(contents)</a></td><td>class="container"として画面を描画します。</td></tr>
<tr><td><a href="#3.4.32">function drowContainerFluid(contents)</a></td><td>class="container-fluid"として画面を描画します。</td></tr>
<tr><td><a href="#3.4.33">function iconAlwaysVisible()</a></td><td>メニューバーにプロダクトアイコンを常に表示します。</td></tr>
<tr><td><a href="#3.4.34">function sequentialApiCall(contents, targetFunc)</a></td><td>複数のREST APIをcontentsの格納順に呼び出します。</td></tr>
</table>
</div>



<H2 ID="3.4">3.4 stkcommonのAPI詳細</H2>
<H3 ID="3.4.1">3.4.1 function showLoginModal(func)</H3>
<div class="topic">
ログインダイアログを表示します。ログインダイアログでは，認証用ユーザー名およびパスワードを指定することができます。<br/>
ログインダイアログで設定したユーザー名およびパスワードは，認証成功後，cookieに24時間記憶され，cookieに存在する間は，本関数を呼び出してもログインダイアログが表示されません。<br/>
認証のため，ログインボタン押下時に引数で指定された関数func()を呼び出します。<br/>
func()の引数として，ログインダイアログで指定したユーザー名，パスワードである，loginId, loginPwが渡されます。func()内でloginId, loginPwを評価する必要があります。<br/>
評価結果は，setLoginResult()を呼び出すことによりstkcommon.jsに通知します。<br/>
<table class="tblstyle">
<tr><td>func[入力]</td><td>認証用関数。引数としてloginId, loginPwが指定される。funcの戻り値は評価されない。</td></tr>
</table>
</div>



<H3 ID="3.4.2">3.4.2 function showInputModal(title, contents)</H3>
<div class="topic">
入力ダイアログを表示します。<br/>
入力ダイアログを閉じるには，closeInputModal()を呼びます。<br/>
<table class="tblstyle">
<tr><td>title[入力]</td><td>入力ダイアログのタイトル</td></tr>
<tr><td>contents[入力]</td><td>入力ダイアログに表示するHTML要素(Contents)</td></tr>
</table>
</div>



<H3 ID="3.4.3">3.4.3 function closeInputModal()</H3>
<div class="topic">
入力ダイアログを閉じます。<br/>
</div>



<H3 ID="3.4.4">3.4.4 function initMainPage(title, iconname, contents)</H3>
<div class="topic">
メインページを初期化します。<br/>
<table class="tblstyle">
<tr><td>title[入力]</td><td>ナビゲーションバーの左側に表示するブランド名</td></tr>
<tr><td>iconname[入力]</td><td>アイコンファイルのパス</td></tr>
<tr><td>contents[入力]</td><td>
  ナビゲーションバーに表示するメニューに関する情報。次の要素を含むJavaScriptオブジェクトの配列を指定。<br/>
  <ul>
  <li>actApiName<br/>メニューを押下したときに呼ぶ括弧付きの関数名</li>
  <li>title<br/>表示するメニューの名称</li>
  </ul>
</td></tr>
</table>
</div>



<H3 ID="3.4.5">3.4.5 function addRsCommand(func, icon, enable)</H3>
<div class="topic">
ナビゲーションバーにコマンドアイコンを追加します。<br/>
<table class="tblstyle">
<tr><td>func[入力]</td><td>コマンドアイコンを押下したときに呼び出される関数。括弧付きで指定する。</td></tr>
<tr><td>icon[入力]</td><td>IcoMoonのアイコンID</td></tr>
<tr><td>enable[入力]</td><td>true:活性, false:非活性</td></tr>
</table>
</div>



<H3 ID="3.4.6">3.4.6 function clearRsCommand()</H3>
<div class="topic">
ナビゲーションバーのコマンドアイコンおよびドロップダウンメニューをクリアします。<br/>
</div>



<H3 ID="3.4.7">3.4.7 function addRsUserMenu(contents)</H3>
<div class="topic">
ユーザーメニューに要素を追加します。<br/>
contents配列に格納されている最後の要素から逆順にメニュー項目を追加します。
<table class="tblstyle">
<tr><td>contents[入力]</td><td>
  ユーザーメニューを構成する情報。次の要素を含むJavaScriptオブジェクトの配列を指定。<br/>
  <ul>
  <li>actApiName<br/>メニューを押下したときに呼ぶ括弧付きの関数名</li>
  <li>title<br/>表示するメニューの名称</li>
  </ul>
</td></tr>
</table>
</div>



<H3 ID="3.4.8">3.4.8 function clearRsUserMenu()</H3>
<div class="topic">
ユーザーメニューをクリアします。<br/>
</div>



<H3 ID="3.4.9">3.4.9 function addDropDown(dropdownTitle)</H3>
<div class="topic">
ナビゲーションバーにドロップダウンメニューを追加します。<br/>
<table class="tblstyle">
<tr><td>dropdownTitle[入力]</td><td>ドロップダウンメニューのタイトル</td></tr>
</table>
</div>



<H3 ID="3.4.10">3.4.10 function changeDropDownTitle(dropdownTitle)</H3>
<div class="topic">
ナビゲーションバーのドロップダウンメニューのタイトルを変更します。<br/>
<table class="tblstyle">
<tr><td>dropdownTitle[入力]</td><td>ドロップダウンメニューのタイトル</td></tr>
</table>
</div>



<H3 ID="3.4.11">3.4.11 function getDropDownMenu(index)</H3>
<div class="topic">
ナビゲーションバーのドロップダウンメニューの要素名を取得します。<br/>
<table class="tblstyle">
<tr><td>index[入力]</td><td>取得する要素のindex</td></tr>
</table>
</div>



<H3 ID="3.4.12">3.4.12 function addDropDownMenu(index, menuTitle, func)</H3>
<div class="topic">
ナビゲーションバーのドロップダウンメニューに要素を追加します。<br/>
<table class="tblstyle">
<tr><td>index[入力]</td><td>追加先のindex</td></tr>
<tr><td>menuTitle[入力]</td><td>ドロップダウンメニューに追加する要素名</td></tr>
<tr><td>func[入力]</td><td>ドロップダウンメニューの要素選択時に実行する関数。括弧付きで指定する。</td></tr>
</table>
</div>



<H3 ID="3.4.13">3.4.13 function addClientMessage(code, msg)</H3>
<div class="topic">
クライアントメッセージを追加します。<br/>
<table class="tblstyle">
<tr><td>code[入力]</td><td>追加するメッセージのキー</td></tr>
<tr><td>msg[入力]</td><td>
  メッセージ。次の要素を含む情報を指定。<br/>
  <ul>
  <li>en<br/>英語メッセージ</li>
  <li>ja<br/>日本語メッセージ</li>
  </ul>
</td></tr>
</table>
</div>



<H3 ID="3.4.14">3.4.14 deleteClientMessage(code)</H3>
<div class="topic">
クライアントメッセージを削除します。<br/>
<table class="tblstyle">
<tr><td>code[入力]</td><td>削除するメッセージのキー</td></tr>
</table>
</div>



<H3 ID="3.4.15">3.4.15 function getClientMessageEn(code)</H3>
<div class="topic">
クライアントメッセージ(英語)を取得します。<br/>
<table class="tblstyle">
<tr><td>code[入力]</td><td>取得するメッセージのキー</td></tr>
</table>
</div>



<H3 ID="3.4.16">3.4.16 function getClientMessageJa(code)</H3>
<div class="topic">
クライアントメッセージ(日本語)を取得します。<br/>
<table class="tblstyle">
<tr><td>code[入力]</td><td>取得するメッセージのキー</td></tr>
</table>
</div>



<H3 ID="3.4.17">3.4.17 function setClientLanguage(lang)</H3>
<div class="topic">
クライアントメッセージの言語を指定します。<br/>
getClientMessage()で取得するメッセージがここで指定した言語に切り替わります。
<table class="tblstyle">
<tr><td>lang[入力]</td><td>getClientMessageで取得するメッセージの言語。0:英語, 1:日本語</td></tr>
</table>
</div>



<H3 ID="3.4.18">3.4.18 function getClientLanguage()</H3>
<div class="topic">
クライアントメッセージの言語を取得します。<br/>
0:英語, 1:日本語
</div>



<H3 ID="3.4.19">3.4.19 function getClientMessage(code)</H3>
<div class="topic">
クライアントメッセージを指定した言語で取得します。<br/>
言語の指定は，setClientLanguage(lang)で行います。<br/>
<table class="tblstyle">
<tr><td>code[入力]</td><td>取得するメッセージのキー</td></tr>
</table>
</div>



<H3 ID="3.4.20">3.4.20 function displayAlertSuccess(parent, msg)</H3>
<div class="topic">
Successメッセージを表示します。<br/>
<table class="tblstyle">
<tr><td>parent[入力]</td><td>メッセージを挿入するdiv要素のID</td></tr>
<tr><td>msg[入力]</td><td>挿入するメッセージ</td></tr>
</table>
</div>



<H3 ID="3.4.21">3.4.21 function displayAlertDanger(parent, msg)</H3>
<div class="topic">
Dangerメッセージを表示します。<br/>
<table class="tblstyle">
<tr><td>parent[入力]</td><td>メッセージを挿入するdiv要素のID</td></tr>
<tr><td>msg[入力]</td><td>挿入するメッセージ</td></tr>
</table>
</div>



<H3 ID="3.4.22">3.4.22 function displayAlertWarning(parent, msg)</H3>
<div class="topic">
Warningメッセージを表示します。<br/>
<table class="tblstyle">
<tr><td>parent[入力]</td><td>メッセージを挿入するdiv要素のID</td></tr>
<tr><td>msg[入力]</td><td>挿入するメッセージ</td></tr>
</table>
</div>



<H3 ID="3.4.23">3.4.23 function displayAlertInfo(parent, msg)</H3>
<div class="topic">
Infoメッセージを表示します。<br/>
<table class="tblstyle">
<tr><td>parent[入力]</td><td>メッセージを挿入するdiv要素のID</td></tr>
<tr><td>msg[入力]</td><td>挿入するメッセージ</td></tr>
</table>
</div>



<H3 ID="3.4.24">3.4.24 function apiCall(method, url, request, keystring, targetFunc)</H3>
<div class="topic">
REST APIを非同期で呼び出します。<br/>
REST APIからレスポンスを受信後，指定した関数をコールバックします。<br/>
リクエスト送信後，1000ミリ秒経過してもREST APIからのレスポンスがない場合，LOADING中を示すダイアログを表示します。<br/>
レスポンスの受信におけるタイムアウト時間は固定で10秒となります。<br/>
REST API呼び出しにおけるステータスおよびレスポンスデータは，stkcommonのグローバル変数statusCode['キー名']およびresponseData['キー名']に格納されます。<br/>
REST API呼び出し時に，HTTPヘッダのAuthorizationには，"Bearer &lt;loginId&gt; &lt;loginPw&gt;"が指定されます。loginIdおよびloginPwは，showLoginModal関数で設定されます。<br/>
<table class="tblstyle">
<tr><td>method[入力]</td><td>HTTPメソッド。'GET', 'POST', 'DELETE', etc</td></tr>
<tr><td>url[入力]</td><td>URL</td></tr>
<tr><td>request[入力]</td><td>リクエストデータ</td></tr>
<tr><td>keystring[入力]</td><td>ステータスおよびレスポンスデータを識別するキー</td></tr>
<tr><td>targetFunc[入力]</td><td>レスポンス受信後に呼び出される関数。括弧および引数は指定できない。</td></tr>
</table>
</div>



<H3 ID="3.4.25">3.4.25 function MultiApiCall(contents, targetFunc)</H3>
<div class="topic">
複数のREST APIを非同期で同時に呼び出します。<br/>REST APIを呼び出す順序は保証されていません。<br/>
すべてのREST APIからレスポンスを受信後，指定した関数をコールバックします。<br/>
リクエスト送信後，1000ミリ秒経過してもすべてのREST APIからのレスポンスがない場合，LOADING中を示すダイアログを表示します。<br/>
レスポンスの受信におけるタイムアウト時間は固定で10秒となります。<br/>
REST API呼び出しにおけるステータスおよびレスポンスデータは，stkcommonのグローバル変数statusCode['キー名']およびresponseData['キー名']に格納されます。<br/>
REST API呼び出し時に，HTTPヘッダのAuthorizationには，"Bearer &lt;loginId&gt; &lt;loginPw&gt;"が指定されます。loginIdおよびloginPwは，showLoginModal関数で設定されます。<br/>
<table class="tblstyle">
<tr><td>contents[入力]</td><td>
  複数のAPIを呼び出すための各種パラメータ。次の要素を含む情報を指定。
  <ul>
  <li>method<br/>HTTPメソッド。'GET', 'POST', 'DELETE', etc</li>
  <li>url<br/>URL</li>
  <li>request<br/>リクエストデータ</li>
  <li>keystring<br/>ステータスおよびレスポンスデータを識別するキー</li>
  </ul>
</td></tr>
<tr><td>targetFunc[入力]</td><td>レスポンス受信後に呼び出される関数。括弧および引数は指定できない。</td></tr>
</table>
</div>



<H3 ID="3.4.26">3.4.26 setLoginResult(result)</H3>
<div class="topic">
ユーザープログラムで行った認証結果をstkcommon.jsに通知します。<br/>
認証成功の場合，開いていたログインダイアログはクローズします。<br/>
<table class="tblstyle">
<tr><td>result[入力]</td><td>0:認証成功, 1:認証失敗, 2:接続エラー(APIの呼び出しに失敗)</td></tr>
</table>
</div>



<H3 ID="3.4.27">3.4.27 function changeLoginPassword(password)</H3>
<div class="topic">
ログインユーザーのパスワードを変更します。<br/>
<table class="tblstyle">
<tr><td>password[入力]</td><td>新しいパスワード</td></tr>
</table>
</div>



<H3 ID="3.4.28">3.4.28 function setAuthenticationToken(token)</H3>
<div class="topic">
認証用トークンを設定します。<br/>
この関数呼び出し後，REST API発行時に，HTTPヘッダのAuthorizationにBearerトークンが指定されます。<br/>
<table class="tblstyle">
<tr><td>token[入力]</td><td>REST APIの認証用トークン。</td></tr>
</table>
</div>



<H3 ID="3.4.29">3.4.29 function getUserName()</H3>
<div class="topic">
ユーザー名を取得します。<br/>
</div>



<H3 ID="3.4.30">3.4.30 function isPasswordCorrect(password)</H3>
<div class="topic">
指定されたパスワードが正しいか判定します。<br/>
true: 指定されたパスワードがログインダイアログで指定したパスワードと一致する<br/>
false: 指定されたパスワードがログインダイアログで指定したパスワードと一致しない<br/>
<table class="tblstyle">
<tr><td>password[入力]</td><td>検証用のパスワード。</td></tr>
</table>
</div>



<H3 ID="3.4.31">3.4.31 function drowContainer(contents)</H3>
<div class="topic">
class="container"として画面を描画します。<br/>
<table class="tblstyle">
<tr><td>contents[入力]</td><td>描画するコンテンツ。</td></tr>
</table>
</div>



<H3 ID="3.4.32">3.4.32 function drowContainerFluid(contents)</H3>
<div class="topic">
class="container-fluid"として画面を描画します。<br/>
<table class="tblstyle">
<tr><td>contents[入力]</td><td>描画するコンテンツ。</td></tr>
</table>
</div>



<H3 ID="3.4.33">3.4.33 function iconAlwaysVisible()</H3>
<div class="topic">
ブラウザのサイズに関係なく、メニューバーにプロダクトアイコンを常に表示します。<br/>
</div>



<H3 ID="3.4.34">3.4.34 function sequentialApiCall(contents, targetFunc)</H3>
<div class="topic">
  複数のREST APIをcontentsの格納順に呼び出します。<br/>呼び出し先のAPIのレスポンスが返るまで次のAPIは呼び出されません。<br/>
  すべてのREST APIからレスポンスを受信後，指定した関数をコールバックします。<br/>
  このAPIは呼び出し直後に，LOADING中を示すダイアログを表示します。<br/>
  レスポンスの受信におけるタイムアウト時間は固定で10秒となります。<br/>
  REST API呼び出しにおけるステータスおよびレスポンスデータは，stkcommonのグローバル変数statusCode['キー名']およびresponseData['キー名']に格納されます。<br/>
  REST API呼び出し時に，HTTPヘッダのAuthorizationには，"Bearer &lt;loginId&gt; &lt;loginPw&gt;"が指定されます。loginIdおよびloginPwは，showLoginModal関数で設定されます。<br/>
  複数のAPI呼び出しにおいて、あるAPIのレスポンスがステータスコード400以上となる場合、本APIは次のAPIの呼び出しを行わず、処理を中断します。<br/>
  <table class="tblstyle">
  <tr><td>contents[入力]</td><td>
    複数のAPIを呼び出すための各種パラメータ。次の要素を含む情報を指定。
    <ul>
    <li>method<br/>HTTPメソッド。'GET', 'POST', 'DELETE', etc</li>
    <li>url<br/>URL</li>
    <li>request<br/>リクエストデータ</li>
    <li>keystring<br/>ステータスおよびレスポンスデータを識別するキー</li>
    </ul>
  </td></tr>
  <tr><td>targetFunc[入力]</td><td>レスポンス受信後に呼び出される関数。括弧および引数は指定できない。</td></tr>
  </table>
</div>



</div>
</BODY>
</html>
